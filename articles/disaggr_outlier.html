<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="disaggR">
<title>Outliers in two-step benchmarks • disaggR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Outliers in two-step benchmarks">
<meta property="og:description" content="disaggR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">disaggR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4.99</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/disaggr.html">Introduction to disaggR</a>
    <a class="dropdown-item" href="../articles/disaggr_outlier.html">Outliers in two-step benchmarks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/InseeFr/disaggR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Outliers in two-step benchmarks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/InseeFr/disaggR/blob/HEAD/vignettes/disaggr_outlier.Rmd" class="external-link"><code>vignettes/disaggr_outlier.Rmd</code></a></small>
      <div class="d-none name"><code>disaggr_outlier.Rmd</code></div>
    </div>

    
    
<p>The Covid-19 pandemic and the economic lockdowns put in place in various countries to tackle with it had led to unusually large drop in economic activity in 2020 and 2021. Trying to estimate this drop in activity in quarterly national accounts using the two-step benchmark method leads to several challenges :</p>
<ul>
<li><p>at first, when no annual data is available for the pandemic years, the method tends to underestimate the drop in activity : the two-step method tends to produce quarterly accounts that are smoother than the indicators, due to the constant and the smothed parts. This is usually not problematic as this smoothing tends to be unbiased : it brings every evolution rates closer to zero (or to the trend of the series for differenciated accounts). It thus reduce the noise of the series while not creating significant bias. But during lockdowns, as most economic indicators are oriented downward, this smoothing creates a significant upward bias, amounting to several points of quarterly GDP at the height of the crisis (Q2 2020)</p></li>
<li><p>then, when annual data become available and is included in the two-step benchmark, there is larger than usual annual residuals in 2020 and 2021 in the benchmaking equation. When the residual is smoothed, this leads to a monthly or quarterly residuals that decreases as soon as mid-2019, well before the beginning of the crisis.</p></li>
</ul>
<p>At Insee, outliers were used to adress both issues in the compilation of QNA. While the logic is sligthly different in the presence or absence of annual data for the period of crisis, it is consistent with both situation, which reduced revisions when we integrated annual data.</p>
<p>This vignette presents the use of outliers in both situation, starting (illogically) with the simpler case of presence of annual data and with the illustrative example of household consumption in food and accommodation services (section I of the nomenclature of activities), often labeled as catering or hospitality services, a sector particularly affected by lockdowns.</p>
<div class="section level2">
<h2 id="the-case-with-annual-accounts">The case with annual accounts<a class="anchor" aria-label="anchor" href="#the-case-with-annual-accounts"></a>
</h2>
<div class="section level3">
<h3 id="what-happens-without-outliers">What happens without outliers<a class="anchor" aria-label="anchor" href="#what-happens-without-outliers"></a>
</h3>
<p>We use monthly, seasonally and working days adjusted (SA-WDA) turnover index (base 100 in 2015) as an indicator for monthly household actual final consumption in current M euros, benchmarked on the corresponding annual account, known up to 2021<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note that this is not exactly how things are down in the actual french QNA : the estimation is done at a lower level, separating hotels from restaurants.&lt;/p&gt;"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">turnover_catering</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">consumption_catering</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-3-1.png" width="98%"></p>
<p>Let’s first use the most basic model, in levels and without constant :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twoStepsBenchmark.html">twoStepsBenchmark</a></span><span class="op">(</span><span class="va">turnover_catering</span>,<span class="va">consumption_catering</span><span class="op">)</span></span></code></pre></div>
<p>We can compare the indicator and the estimated QNA series<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The levels-rebased series are computed by setting the first value of both the indicator and the benchamrked account at 100. Here the first value is in January 1999.&lt;/p&gt;"><sup>2</sup></a> :</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark</span>, type<span class="op">=</span><span class="st">"levels-rebased"</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-5-1.png" width="98%"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2018</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-6-1.png" width="98%"></p>
<p>The timing of Covid restrictions is clearly apparent on both the indicator (HF serie) and the benchmarked account (benchmark), with a first lockdown between March and May 2020, a second lockdown in November 2020, followed by a curfew that had an as strong impact on the consumptions of hotel and restaurant services, up to June 2021. In January 2022, the drop of activity is due to the Omicron variant of the Covid-19 virus, with no lockdown but a very large number of people affected and in quarantine at home.</p>
<p>The benchmark is quite good, and the account follows closely the indicator, with scaled-down evolutions. But we can clearly see in the account a decrease in consumption from mid-2019, that is not present in the indicator.</p>
<p>This is an artefact caused by the smoothing of the residual. There is a sharp 6 b€ drop in the annual residual between 2019 and 2020, and the smoothing procedure tries to compute a monthly series with the most gradual drop, thus starting to decrease in May 2019, which is clearly absurd in that case.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/smoothed.part.html">smoothed.part</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-7-1.png" width="98%"></p>
<p>There is thus a significant contribution of the smoothed part to the QNA evolution in 2019-2020 :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark</span>, type <span class="op">=</span><span class="st">"contributions"</span><span class="op">)</span>, start<span class="op">=</span><span class="fl">2018</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-8-1.png" width="98%"></p>
</div>
<div class="section level3">
<h3 id="introduction-of-outliers">Introduction of outliers<a class="anchor" aria-label="anchor" href="#introduction-of-outliers"></a>
</h3>
<p>The idea behind the outlier is to capture this larger than usual residual and to affect it to the correct months and quarters. While we don’t know why there is a larger than usual gap between the indicator and the account, we are pretty sure that it is related to the Covid lockdowns. It is thus a better assumption to try to disaggregate this residual according to a measure of the stringency of the lockdowns rather than smoothing it agnostically over the year 2019 to 2022.</p>
<p>While there is a lot of ways to build this outlier indicator, a convenient way is to derive it from the usual indicator. In this example, we see that the turnover index is close to 130 before and after the lockdowns. Thus the distance to 130 is a good indicator of the intensity of the crisis :</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">turnover_catering</span><span class="op">-</span><span class="fl">130</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2021</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outlier</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">outlier</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-9-1.png" width="98%"></p>
<p>The absolute value of the indicator is lower than 2 in January and February 2020 and after August 2021, so we set it to 0 for those months, restricting the outliers to the lockdowns period.</p>
<p>The idea is to add this outlier to the benchmark relation, as an additive outliers :</p>
<p><span class="math display">\[
C =  I * a + out * b + u
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(C\)</span>, an univariate time series, is the high-frequency account.</li>
<li>
<span class="math inline">\(I\)</span>, a matrix time series, combines the columns of the indicators and the constant.</li>
<li>
<span class="math inline">\(a\)</span>, a numeric vector, stands for the coefficients to be applied.</li>
<li>
<span class="math inline">\(out\)</span> is the matrix time series of the ouliers. Here we have one additive outliers, completed with 0 outside the 2020-2021 period.</li>
<li>
<span class="math inline">\(b\)</span>, a numeric vector, stands for the coefficients to be applied to the outliers.</li>
<li>
<span class="math inline">\(u\)</span>, an univariate time series, is the smoothed part of the benchmark.</li>
</ul>
<p>The <strong>coefficients are estimated at low-frequency</strong> with the annual accounts, the annualized turnover index and the aggregated outlier :</p>
<p><span class="math display">\[
C_{aggregated}' =  I_{aggregated}' * a + out_{aggregated} * b + u'
\]</span></p>
<p>These <strong>coefficients are applied at high-frequency</strong>, to obtain the fitted values of the benchmark:</p>
<p><span class="math display">\[
\text{fitted.values} = I * a + out * b
\]</span> <strong>u is smoothed as usual</strong>:</p>
<p><span class="math display">\[
u = smooth(extrapolation(C_{aggregated} - \text{fitted.values}_{aggregated}))
\]</span> This can be done using outliers in the <code>twoStepsBenchmark</code> function :</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twoStepsBenchmark.html">twoStepsBenchmark</a></span><span class="op">(</span><span class="va">turnover_catering</span>,<span class="va">consumption_catering</span>, </span>
<span>                                    outliers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>AO2020 <span class="op">=</span> <span class="va">outlier</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">benchmark_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Estimate      StdErr   t.value      p.value</span></span>
<span><span class="co">#&gt; constant 24179.889019 1540.386318 15.697289 1.038088e-12</span></span>
<span><span class="co">#&gt; hfserie     46.720760    1.519744 30.742528 2.598318e-18</span></span>
<span><span class="co">#&gt; AO2020       7.964003    2.941739  2.707243 1.356125e-02</span></span></code></pre></div>
<p>In this example, the indicator and the outlier are colinear in the lockdown period, so this is equivalent to estimated a specific <code>a</code> coefficient for the lockdown period, with an account that follow more closely the indicator during that period.</p>
<p>The resulting account reflects better the economic outlook, without contributions of the smoothed part in the end of 2019 :</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_out</span>, type <span class="op">=</span><span class="st">"contributions"</span><span class="op">)</span>, start<span class="op">=</span><span class="fl">2018</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_out</span>, type<span class="op">=</span><span class="st">"levels-rebased"</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-12-1.png" width="98%"><img src="disaggr_outlier_files/figure-html/unnamed-chunk-12-2.png" width="98%"></p>
<p>The variation of the residual and the smoothed part are much lower :</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">benchmark_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/smoothed.part.html">smoothed.part</a></span><span class="op">(</span><span class="va">benchmark_out</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-13-1.png" width="98%"></p>
</div>
</div>
<div class="section level2">
<h2 id="the-case-without-annual-account">The case without annual account<a class="anchor" aria-label="anchor" href="#the-case-without-annual-account"></a>
</h2>
<p>Let’s go back in August 2020 : the turnover index is known up to June 2020 and the annual account up to 2019.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover_catering_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">turnover_catering</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">consumption_catering_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">consumption_catering</span>, end <span class="op">=</span> <span class="fl">2019</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twoStepsBenchmark.html">twoStepsBenchmark</a></span><span class="op">(</span><span class="va">turnover_catering_2020</span>,<span class="va">consumption_catering_2020</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">benchmark_2020</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Estimate      StdErr  t.value      p.value</span></span>
<span><span class="co">#&gt; constant 24237.70495 1582.064943 15.32030 3.793344e-12</span></span>
<span><span class="co">#&gt; hfserie     46.65203    1.564194 29.82496 2.018110e-17</span></span></code></pre></div>
<p>As 2020 does not enter into the estimation of the annual residual, there is no smoothing related issue here. But the message of the indicator is clearly attenuated in the monthly account : while the indicator in April 2020 is at 17 % of its February level, the account in April is at 38 % of its April level, more than twice that level.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_2020</span>, type <span class="op">=</span><span class="st">"contributions"</span><span class="op">)</span>, start<span class="op">=</span><span class="fl">2018</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_2020</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-16-1.png" width="98%"><img src="disaggr_outlier_files/figure-html/unnamed-chunk-16-2.png" width="98%"></p>
<p>To correct this, we will use the same specification for the outlier. But as the annual account for 2020 is not yet known, the coefficients for the outlier is not known, and we will have to manually specify it.</p>
<p>One of the way to do so is to compute the value of the coefficient that will enable the account to follow exactly the indicator.</p>
<p>We have a drop of around 110 points in the turnover index between February and April, and we would like to have a 83 % drop in the account, from a value of 8 000 M€. So we can compute <span class="math inline">\(b\)</span> as :</p>
<p><span class="math display">\[
b = 8000 * 0.83/110-a  \approx 14
\]</span></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_out_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twoStepsBenchmark.html">twoStepsBenchmark</a></span><span class="op">(</span><span class="va">turnover_catering_2020</span>,<span class="va">consumption_catering_2020</span>, </span>
<span>                                    outliers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>AO2020 <span class="op">=</span> <span class="va">outlier</span><span class="op">)</span>,</span>
<span>                                    set.coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>AO2020 <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span>                                        <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">benchmark_out_2020</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Estimate      StdErr  t.value      p.value</span></span>
<span><span class="co">#&gt; constant 24237.70495 1582.064943 15.32030 3.793344e-12</span></span>
<span><span class="co">#&gt; hfserie     46.65203    1.564194 29.82496 2.018110e-17</span></span>
<span><span class="co">#&gt; AO2020      14.00000          NA       NA           NA</span></span></code></pre></div>
<p>This is a broad assumption, but the resulting estimates for April 2020 (1574 M€) is closer than the estimates without outlier (3085 M€) from the final estimates using annual accounts for 2020 and 2021 and outliers (2161 M€). And the value for <span class="math inline">\(b\)</span> (14) is not so far from the final estimated value (8).</p>
<p>One could have anticipated that, in the annual account, total final consumption will drop less than turnover in April, as it includes government consumption in hotels (for some social assistance policies that continued during lockdown) and excludes collective firms and factories restaurants, totally closed during lockdown, thus going for a slighlty lower <span class="math inline">\(b\)</span> coefficient, very close to the final estimate.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_out_2020</span>, type <span class="op">=</span><span class="st">"contributions"</span><span class="op">)</span>, start<span class="op">=</span><span class="fl">2018</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_disaggr.html">in_disaggr</a></span><span class="op">(</span><span class="va">benchmark_out_2020</span>, type<span class="op">=</span><span class="st">"levels-rebased"</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="disaggr_outlier_files/figure-html/unnamed-chunk-19-1.png" width="98%"><img src="disaggr_outlier_files/figure-html/unnamed-chunk-19-2.png" width="98%"></p>
</div>
<div class="section level2">
<h2 id="specification-of-the-ouliers">Specification of the ouliers<a class="anchor" aria-label="anchor" href="#specification-of-the-ouliers"></a>
</h2>
<ul>
<li><p>Outliers need to be specified on <em>complete low-frequency period</em>, so one or more complete year(s) for a annual to monthly or quarterly disaggregation and one or more complete quarter(s) for a quarterly to monthly disaggregation.</p></li>
<li><p>Outliers can be additive outliers (AO) or level shifts (LS). Additive outliers are completed with zeroes before and after the specified values, while level shifts are completed with 0 before the specified values and with the last specified values after.</p></li>
<li>
<p>Outliers are specified as a named list of numeric vectors, whose pattern is like list(AO2008T2=c(0,0,3,2),LS2002=c(0.1,0.1,0.1,0.1)) where :</p>
<ul>
<li><p>“AO” stands for additive outlier or “LS” for level shift</p></li>
<li><p>The integer that follows stands for the outlier starting year</p></li>
<li><p>an optional integer, preceded by the letter T, stands for the low-frequency cycle of the outlier start.</p></li>
<li><p>The numeric vector values stands for the disaggregated value of the outlier and its length must be a multiple of hf / lf.</p></li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AO2020</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span> <span class="co"># A one-year AO in 2020, with half the weight in Q2 </span></span>
<span>                    <span class="co"># and the rest split between Q1 and Q3 </span></span>
<span></span>
<span><span class="va">AO2008T2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span> <span class="co"># A one-quarter AO in the second quarter of 2008, </span></span>
<span>                  <span class="co"># which is concentrated in June</span></span>
<span></span>
<span><span class="va">LS2010</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span> <span class="co"># A level shift that start in Q2 2010 and increase </span></span>
<span>                    <span class="co"># gradually in Q3 and Q4, and remains at its level afterwards</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arnaud Feldmann, Thomas Laurent.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
